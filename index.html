<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="./fv-icon.png" type="image/x-icon">
    <title>Lobby</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            position: fixed;
            bottom: 20px;
            width: 80%;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
        }

        /* Chat screen full responsive */
        .containe {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.3);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
        }

        h1,
        h2 {
            text-align: center;
        }

        button {
            background: #2563eb;
            border: none;
            color: white;
            padding: 10px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            margin-top: 8px;
            width: 100%;
        }

        button:hover {
            background: #1d4ed8;
        }

        textarea,
        input {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: none;
            margin-top: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .copy-btn {
            background: #10b981;
            margin-top: 5px;
        }

        .copy-btn:hover {
            background: #059669;
        }

        .hidden {
            display: none;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            color: white;
        }

        .badge.online {
            background: #22c55e;
        }

        /* Chat area */
        #chat {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-size: 16px; /* bigger font */
        }

        /* Message spacing */
        #chat div {
            margin-bottom: 10px;
        }

        .me {
            text-align: right;
            color: #4ade80;
        }

        .other {
            text-align: left;
            color: #38bdf8;
        }

        /* Chat input fixed bottom */
        .chat-input {
            display: flex;
            gap: 6px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
        }

        .chat-input input {
            flex: 1;
        }

        .chat-input button {
            width: auto;
        }

        /* Status badge at top */
        .chat-header {
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        @media (max-width: 600px) {
            body {
                padding: 0;
            }
        }
    </style>
</head>

<body>
    <div class="container" id="startScreen">
        <p style="text-align: center;">Choose An Option</p>
        <button id="chooseCreate">Create Room</button>
        <button id="chooseJoin">Join Room</button>
    </div>

    <div class="container hidden" id="createScreen">
        <h2>Create Room</h2>
        <button id="createOfferBtn">Generate Offer Code</button>
        <textarea id="offerOut" placeholder="Offer code will appear here" readonly></textarea>
        <button class="copy-btn" data-copy="offerOut">Copy Offer Code</button>

        <textarea id="answerIn" placeholder="Paste answer code here"></textarea>
        <button id="connectBtn">Connect</button>
    </div>

    <div class="container hidden" id="joinScreen">
        <h2>Join Room</h2>
        <textarea id="offerIn" placeholder="Paste offer code here"></textarea>
        <button id="createAnswerBtn">Generate Answer Code</button>
        <textarea id="answerOut" placeholder="Answer code will appear here" readonly></textarea>
        <button class="copy-btn" data-copy="answerOut">Copy Answer Code</button>
    </div>

    <!-- Chat Screen -->
    <div class="containe hidden" id="chatScreen">
        <div class="chat-header">
            <span id="statusBadge" class="badge">Offline</span>
        </div>
        <div id="chat"></div>
        <div class="chat-input">
            <input id="msg" placeholder="Type message..." />
            <button id="sendBtn">Send</button>
        </div>
    </div>

    <script>
        const startScreen = document.getElementById('startScreen');
        const createScreen = document.getElementById('createScreen');
        const joinScreen = document.getElementById('joinScreen');
        const chatScreen = document.getElementById('chatScreen');
        const statusBadge = document.getElementById('statusBadge');
        const chatDiv = document.getElementById('chat');
        const msgInput = document.getElementById('msg');

        let pc, dc;
        const config = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

        function showScreen(screen) {
            [startScreen, createScreen, joinScreen, chatScreen].forEach(s => s.classList.add('hidden'));
            screen.classList.remove('hidden');
        }

        function logMsg(msg, type) {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = msg;
            chatDiv.appendChild(div);
            chatDiv.scrollTop = chatDiv.scrollHeight;
        }

        function updateStatus(online) {
            statusBadge.textContent = online ? "Online" : "Offline";
            statusBadge.classList.toggle('online', online);
        }

        document.getElementById('chooseCreate').onclick = () => showScreen(createScreen);
        document.getElementById('chooseJoin').onclick = () => showScreen(joinScreen);

        // Copy buttons (mobile-friendly)
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.onclick = () => {
                const targetId = btn.getAttribute('data-copy');
                const text = document.getElementById(targetId).value;

                navigator.clipboard.writeText(text).then(() => {
                    btn.textContent = "Copied!";
                    setTimeout(() => btn.textContent = "Copy " + (targetId.includes("offer") ? "Offer" : "Answer") + " Code", 1500);
                }).catch(() => {
                    const temp = document.createElement("textarea");
                    temp.value = text;
                    document.body.appendChild(temp);
                    temp.select();
                    document.execCommand("copy");
                    document.body.removeChild(temp);

                    btn.textContent = "Copied!";
                    setTimeout(() => btn.textContent = "Copy " + (targetId.includes("offer") ? "Offer" : "Answer") + " Code", 1500);
                });
            };
        });

        document.getElementById('createOfferBtn').onclick = async () => {
            pc = new RTCPeerConnection(config);
            dc = pc.createDataChannel('chat');
            dc.onmessage = e => logMsg(e.data, 'other');
            dc.onopen = () => {
                updateStatus(true);
                showScreen(chatScreen);
            };
            dc.onclose = () => updateStatus(false);
            const offer = await pc.createOffer();
            await pc.setLocalDescription(offer);
            pc.onicecandidate = e => {
                if (!e.candidate) document.getElementById('offerOut').value = JSON.stringify(pc.localDescription);
            };
        };

        document.getElementById('createAnswerBtn').onclick = async () => {
            pc = new RTCPeerConnection(config);
            pc.ondatachannel = e => {
                dc = e.channel;
                dc.onmessage = ev => logMsg(ev.data, 'other');
                dc.onopen = () => {
                    updateStatus(true);
                    showScreen(chatScreen);
                };
                dc.onclose = () => updateStatus(false);
            };
            await pc.setRemoteDescription(JSON.parse(document.getElementById('offerIn').value));
            const answer = await pc.createAnswer();
            await pc.setLocalDescription(answer);
            pc.onicecandidate = e => {
                if (!e.candidate) document.getElementById('answerOut').value = JSON.stringify(pc.localDescription);
            };
        };

        document.getElementById('connectBtn').onclick = async () => {
            await pc.setRemoteDescription(JSON.parse(document.getElementById('answerIn').value));
        };

        document.getElementById('sendBtn').onclick = () => {
            if (dc && dc.readyState === 'open' && msgInput.value.trim() !== "") {
                dc.send(msgInput.value);
                logMsg(msgInput.value, 'me');
                msgInput.value = '';
            }
        };
    </script>
</body>
</html>
